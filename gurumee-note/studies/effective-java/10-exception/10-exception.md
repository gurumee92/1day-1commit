# 예외
===

![대표사진](../intro.png)

> 책 "이펙티브 자바 3판"을 공부하면서 정리한 문서입니다.


## 예외는 진짜 예외 상황에만 사용하라

자바의 예외는 예외 상황에서만 사용한다.

```java
try {
    int i = 0;
    
    while(true) {
        range[i++].climb();
    }
} catch (Exception e) {
    // ...
}
```

이런 코드를 짜면 안된다는 것이다. 절대!! **일상적인 제어 흐름용**으로 쓰면 안된다. `Iterator`처럼 `hasNext` 메서드를 제공하여, 클라이언트가, 오류날 가능성을 적게 API를 설계하라.

다음은 책에서 권고하는, 상태 검사 메서드, 옵셔널, 혹은 특정 값 중 하나를 선택하는 지침이다.

1. 외부 동기화 없이 여러 스레드가 동시에 접근할 수 있거나 외부 요인으로 상태가 변할 수 있다면, 옵셔널이나 특정 값을 사용한다.
2. 성능이 중요한 상황에서 상태 검사 메서드가 상태 의존적 메서드의 작업 일부를 중복 수행한다면, 옵셔널이나 특정 값을 사용한다.
3. 그 외 모든 경우엔 상태 검사 메서드 방식이 낫다.


## 복구할 수 있는 상황에는 검사 예외를, 프로그래밍 오류에는 런타임 예외를 사용하라

자바에서 문제 상황을 알리는 타입으로는 검사 예외, 런타임 예외, 에러 이렇게 3가지가 있다. 이들을 사용하는 지침은 다음과 같다.

1. 호출하는 쪽에서 복구하리라 여겨지는 상황이라면, 검사 예외를 사용하라
2. 프로그래밍 오류를 나타낼 때는 런타임 예외를 사용하라

쉽게 말해서, 복구 가능하다면, 검사 예외 아니라면 런타임 예외를 사용하라는 것이다. 또한, 책에서는 개발자가 구현하는 비검사 `Throwable`은 모두 `RuntimeException` 하위 클래스를 만들 것을 권고 하고 있다. 또한, `Exception`, `RuntimeException`, `Error`를 절대로 상속해서 쓰지 말 것을 당부하고 있다.


## 필요 없는 검사 예외 사용은 피하라

다음 코드 조각들을 보자.

```java
try {
    // ...
} catch (TheCheckedException e) {
    throw new AssertionError();
}
```


```java
try {
    // ...
} catch (TheCheckedException e) {
    e.printStackTrace();
    System.exit(1);
}
```

예외를 다룰 때, 흔히 나올 수 있는 패턴이다. 그러나 한 번쯤 이 코드가 최선인지 생각해 볼 필요가 있다. 이렇게 하면, 해당 코드 블럭의 비용이 꽤 올라가기 때문이다. `try` 블록을 사용해야 하는 것을 물론이고, `Stream API`를 쓸 수 없다. 따라서, 검사 예외가 하나 뿐이라면 피하는 것이 더 좋다. 검사 예외를 회피하는 가장 쉬운 방법은 적절한 결과 타입을 담은 `Optional` 객체를 반환하는 것이다.

또 다른 방법으로, 검사 예외를 던지는 메서드를 2개로 쪼개 비검사 예외로 바꾸는 것이다. 항상 적용할 수는 없지만, 조금 더 유연성을 제공한다. 그러나 2 가지 방식 다 단점들이 존재하니 사용할 때 주의해야 한다.


## 표준 예외를 사용하라

"바퀴를 재 발명하지 말자." 예외도 이를 벗어날 수 없다. 표준 예외를 익히면, 개발자에게 이득이 될 것이다. 중요한 것은 `Exception`, `RuntimeException`, `Throwable`, `Error`는 직접 사용하지 말라는 것이다. 책에서 정리한 표준 예외들은 다음과 같다.

| 예외 | 사용처 |
| :-- | :-- |
| IllegalArgumentException | 허용하지 않는 값이 인수로 건네졌을 때 |
| IllegalStateException | 객체가 메서드를 수행하기에 적절하지 않은 상태일 때 |
| NullPointException | null을 허용하지 않는 메서드에 null을 건넸을 때 |
| IndexOutOfBoundsException | 인덱스가 범위를 벗어날 때 |
| ConcurrentModificationException | 허용하지 않는 동시 수정이 발견됐을 때 |
| UnsupportedOperationException | 호출한 메서드를 지원하지 않을 때 |

숫자를 다루는 경우 `ArithmeticException` 혹은 `NumberFormatException` 등을 재사용할 수 있을 것이다. 상황이 부합한다면, 표준 예외를 쓰는 것이 좋다.


## 추상화 수준에 맞는 예외를 던져라

## 메서드가 던지는 모든 예외를 문서화하라

## 예외의 상세 메세지에 실패 관련 정보를 담으라

## 가능한 한 실패 원자적으로 만들라

## 예외를 무시하지 말라
    