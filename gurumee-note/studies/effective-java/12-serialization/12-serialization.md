# 직렬화
===

![대표사진](../intro.png)

> 책 "이펙티브 자바 3판"을 공부하면서 정리한 문서입니다.


## 자바 직렬화의 대안을 찾으라

"직렬화"란 장이란 말이 무색하게 처음부터 직렬화를 쓰지 말 것을 책을 권고하고 있다. 왜냐하면, 직렬화는 매우 위험하기 때문이다. 책에 적힌 `로버트 시커드`의 말을 적어보겠다.

> 자바의 역직렬화는 명백하고 현존하는 위험이다. 이 기술은 지금도 애플리케이션에서 직접 혹은 RMI, JMX, JMS 등의 하부 시스템을 통해 간접적으로 쓰이고 있기 때문이다. 신뢰할 수 없는 스트림을 역직렬화하면 원격 코드 실행, 서비스 거부 등의 공격으로 이어질 수 있다. 잘못한게 아무것도 없는 애플리케이션이라도 이런 공격에 취약해질 수 있다.

이런 위험을 제거하기 위한 제일 좋은 방법은 무엇일까? 바로 "**직렬화를 쓰지 않는 것**"이다.책에서는 다른 대안을 쓸 것을 권고하고 있다. 이를테면, `JSON`, `gRPC(Protobuf)`등 이 대표적인 예이다. 같은 맥락으로 레거시의 경우, **직렬화를 쓰고 있다면, 신뢰할 수 있는 데이터 외에 직렬화/역직렬화하지 말자**.

> 참고! 가젯이란?
>
> 공격자와 보안 전문가들이 자바 라리브러리와 널리 쓰이는 서드파티 라이브러리에서 직렬화 기능 타입들을 연구하여, 역직렬화 과정에서 호출되어 잠재적으로 위험한 동작을 수행하는 메서드를 일컫는다.


## Serializable을 구현할지는 신중히 결정하라

직렬화는 `Serializable` 인터페이스를 `implements`만 선언하기만해도 할 수 있다. 그러나 그 위험성은 앞 절에서 봤듯이 매우 크기 때문에, 구현할 지는 신중히 결정해야 한다. 책에서는 다음의 3가지 이유로 신중히 결정할 것을 권고하고 있다.

1. `Serializable`을 구현하면, 릴리스한 뒤에는 수정하기 어렵다.
2. `Serializable`을 구현하면, 버그와 보안의 구멍이 생길 위험이 높다.
3. `Serializable`을 구현하면, 해당 클래스의 신 버전을 릴리즈할 때 테스트할 것이 늘어난다.

직렬화를 구현하게 되면, 그 클래스는 공개 API가 된다. 널리 퍼진다면, 그 형태로 영원히 지원해야 한다. 또한, 생성자 외에 인스턴스를 만들 수 있기 때문에, 언어의 기본 매커니즘을 우회할 수 있다. 또한 릴리즈된 직렬화를 구현하는 클래스를 버전 별로 직렬화/역직렬화할 수 있는 테스트를 매번 해야 한다. 

책에서는 또한, 상속용으로 설계된 클래스는 `Serializable`을 구현하면 안되며 인터페이스도 `Serializable`을 확장해서도 안된다.

## 커스텀 직렬화 형태를 고려해보라

## readObject 메서드는 방어적으로 작성하라

## 인스턴스 수를 통제해야 한다면 readResolve보다는 열거 타입을 사용하라

## 직렬화된 인스턴스 대신 직렬화 프록시 사용을 검토하라