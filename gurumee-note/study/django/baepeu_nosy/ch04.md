북마크
================

Contents
--------------

1. 시작하며..
2. 프로젝트 셋업
3. 모델 만들기
4. 북마크 목록 보기 기능 만들기
5. 북마크 추가 기능 만들기
6. 북마크 상세 보기 기능 만들기
7. 북마크 수정 기능 만들기
8. 북마크 UI 개선하기
9. 배포하기
10. 마치며..

## 시작하며..

이번 장에서는 "북마크" 그러니까 사이트 이름과 URL 을 저장하고, 그것들의 목록을 보여주고 추가/수정/삭제할 수 있는 간단한 앱을 만들어볼 것입니다.


## 프로젝트 셋업

프로젝트 셋업을 합시다. 먼저 적당한 위치에서 프로젝트 디렉토리를 생성해주세요.

```bash
# bookmark 디렉토리 생성
$ mkdir bookmark

# bookmark 위치로 이동
$ cd bookmark
```

이제 파이썬 가상 환경을 만들어줍니다.

```bash
# 가상 환경 설정
$ python3 -m virtualenv venv

# 가상 환경 활성화
$ source venv/bin/activate

# 제대로 설정이 됬다면 (venv)가 떠야 합니다!
$ (venv) _
```

이제 장고를 설치합니다.

```bash
# 장고 설치
$ (venv) pip install django
```

그 후 장고 프로젝트를 설정합니다.

```bash
# 장고 프로젝트 설정
$ (venv) django-admin startproject config .
```

그리고 프로젝트에서 쓸 관리자 계정을 생성하도록 하겠습니다.

```bash
$ (venv) python manage.py createsuperuser 
```

이제 `bookmark` 앱을 만들어보겠습니다.

```bash
# bookmark 앱 생성
$ (venv) python manage.py startapp bookmark
```

그 후 `config/settings.py`에서 북마크 앱을 연결해줍니다.

bookmark/config/settings.py
```python
# ...

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'bookmark', # 추가 코드
]

# ...
```

자 이렇게 해서 프로젝트 셋업이 끝났습니다.

## 모델 만들기

이제 모델을 만들겠습니다. `bookmark/models.py`에 다음 코드를 입력하세요.

bookmark/bookmark/models.py
```python
from django.db import models

# Create your models here.
class Bookmark(models.Model):

    site_name = models.CharField(max_length=100)
    url = models.URLField('Site URL')

    def __str__(self):
        return "name: {}, address: {}".format(self.site_name, self.url)
```

우리가 앱에서 사이트 이름과 url을 저장할 수 있도록 site_name, url 필드를 지정하였습니다. 이제 모델을 만들었으니 마이그레이션을 합시다.

```bash
# 북마크 앱 마이그레이션 생성
$ (venv) python manage.py makemigrations bookmark

# 전체 프로젝트 마이그레이션
$ (venv) python manage.py migrate
```

자, 이제 관리자 페이지와 모델을 연결해보겠습니다. `bookmark/admin.py`에 다음 코드를 입력하세요.

bookmark/bookmark/admin.py
```python
from django.contrib import admin

# Register your models here.
from .models import Bookmark

admin.site.register(Bookmark)
```

이제 개발 서버를 실행한 후 관리자 페이지에 들어가서, 원활한 실습을 위해 몇 개의 북마크를 추가해 주세요.

```bash
# 서버 실행
$ (venv) python manage.py runserver
```

    참고! 관리자 페이지 들어가기
    관리자는 http://localhost:8000/admin 으로 들어갈 수 있습니다. 처음 설정한 관리자 계정으로 로그인 해보세요. 만약 잘 설정했다면 북마크를 관리할 수 있는 Bookmarks를 볼 수 있을 것입니다.

    참고! 관리자 페이지와 모델의 __str__ 메소드
    관리자의 등록된 모델에 __str__ 메소드가 없으면, 데이터 목록에서 `Bookmark object(1)` 형식으로 출력이 됩니다. 이러면 관리자 페이지임에도 우리가 볼 수 있는 것이 한정적이죠. 저번 장에서 배운 관리자 커스터마이징도 쓸 수 있지만 필드가 매우 간단하기 때문에, 모델의 __str__ 메소드로 설정한 것입니다.


## 북마크 목록 보기 기능 만들기

이번에는 북마크 목록 보기 기능을 만들어보겠습니다. 우리는 저번 시간에 제네릭 뷰에 대해서 배웠는데, 장고는 목록 보기 뿐 아니라, 상세보기, 추가/수정/삭제 할 수 있는 제네릭 뷰들을 모두 만들어 두었습니다. 우리는 그것을 이용할 것입니다. `bookmark/views.py`에 다음을 입력해주세요.

bookmark/bookmark/views.py
```python
from django.views.generic.list import ListView

from .models import Bookmark
# Create your views here.

class BookmarkListView(ListView):
    model = Bookmark
```

그리고 이 뷰와 url을 연결하겠습니다. 북마크 목록은 `bookmark/` url에 연결하겠습니다. 먼저 `bookmark/urls.py`를 만들고 다음을 입력하세요.

bookmark/bookmark/urls.py
```python
from django.urls import path

from .views import BookmarkListView

urlpatterns = [
    path('/', BookmarkListView.as_view(), name='list'),
]
```

이 url이 bookmark/ 에서 "/"의 역할을 합니다. 이제 `config/urls.py`에서 bookmark 앱의 url들을 연결하겠습니다. 다음을 해당 파일에 입력해주세요.

bookmark/config/urls.py
```python
from django.contrib import admin
# include 메소드를 추가합니다.
from django.urls import path, include 

urlpatterns = [
    path('admin/', admin.site.urls),
    # 아래 코드가 추가 코드입니다.
    path('bookmark/', include('bookmark.urls'))
]
```

이제 뷰와 템플릿을 연결하겠습니다. `bookmark/templates/bookmark/bookmark_list.html` 파일을 만들고 다음을 입력해주세요.

bookmark/bookmark/templates/bookmark/bookmark_list.html
```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>북마크 리스트 뷰</title>
    </head>
    <body>
        <div class="btn-group">
            <a href="#" class="btn btn-info">Add Bookmark</a>
        </div>
        <p></p>
        <table class="table">
            <thead>
                <th scope="col">#</th>
                <th scope="col">Site</th>
                <th scope="col">URL</th>
                <th scope="col">Modify</th>
                <th scope="col">Delete</th>
            </thead>
            <tbody>
                {% for bookmark in object_list %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <a href="#">{{ bookmark.site_name }}</a>
                        </td>
                        <td>
                            <a href="{{ bookmark.url }}" target="_blank">{{ bookmark.url }}</a>
                        </td>
                        <td>
                            <a href="#" class="btn btn-success btn-sm">Modify</a>
                        </td>
                        <td>
                            <a href="#" class="btn btn-danger btn-sm">Delete</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </body>
</html>
```

여기서 `{% for bookmark in object_list %}`에서 **object_list**는 제네릭 뷰를 상속 받은 **BookmarkListView**가 해당 모델의 리스트를 만들어 넣어주는 값입니다. 이것을 렌더리하는 것이지요. 이제 개발 서버를 구동시키면 테이블 형태로 북마크가 보일 것입니다.


## 북마크 추가 기능 만들기

자, 북마크 추가 기능을 만들어 봅시다. 먼저 `bookmark/views.py`에 제네릭 뷰 중 모델을 생성할 수 있는 `CreateView`를 상속 받아 뷰를 만들어보겠습니다. 다음은 코드입니다.

bookmark/bookmark/views.py
```python
## 동일

from django.views.generic.edit import CreateView
from django.urls import reverse_lazy

# 동일

class BookmarkCreateView(CreateView):
    model = Bookmark
    # 폼으로 입력 받을 필드
    fields = ['site_name', 'url'] 
    # 폼 입력 후 모델이 성공적으로 만들어지면 이동할 페이지 -> / (name=list)
    success_url = reverse_lazy('list')
    # 사용할 템플릿의 접미사를 변경하는 설정 값.
    template_name_suffix = '_create'
```

안에 필드를 자세히 살펴봅시다. `model`은 `BookmarkListView`에서 썼듯이 말 그대로 해당 모델을 의미합니다. `fileds`는 보통 데이터를 생성할 때 form 태그 형식으로 넘어오는데 그 때 쓰일 필드들을 뜻합니다. `success_url`은 데이터 생성이 성공했을 때 리다이렉트할 url을 뜻합니다. 여기서는 **reverse_lazy** 라는 함수로 urls.py 에서 정의한 `list`라는 이름의 url로 연결합니다. 즉 성공한 후에 바로 목록 뷰로 이동합니다. `template_name_suffix`는 템플릿 파일의 접미사를 뜻합니다. 즉 ~_create.html 을 만들면 이 파일을 템플릿으로 씁니다.

이제 이 뷰를 url로 연결하겠습니다. `bookmark/urls.py`에 "add/" url에 우리가 만든 `BookmarkCreateView`를 연결해주세요. 다음은 코드입니다.

bookmark/bookmark/urls.py
```python
from django.urls import path
# BookmarkCreateView 추가
from .views import BookmarkListView, BookmarkCreateView # BookmarkCreateView 추가

urlpatterns = [
    path('', BookmarkListView.as_view(), name='list'),
    # 아래가 추가 코드입니다.
    path('add/', BookmarkCreateView.as_view(), name='add'),
]
```

자 이제, 모델을 생성할 페이지 `bookmark/templates/bookmark/bookmark_create.html`를 만들어 뷰와 연결하겠습니다.

bookmark/bookmark/templates/bookmark/bookmark_create.html
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>Bookmark Create View</title>
</head>
<body>
    <form action="" method="post">
        <!-- csrf 토큰 방지 --->
        {% csrf_token %}
        <!-- 클래스 형 뷰의 옵션 값. 설정한 필드 폼 태그 출력 후 p 태크로 감싸줌. -->
        {{ form.as_p }}
        <input type="submit" value="Add" class="btn btn-info btn-sm"/>
    </form>
</body>
</html>
```

여기서 템플릿 엔진 코드를 살펴봅시다. `{% csrf_token %}`은 CSRF(Cross Site Request Forgrey) 공격을 막기 위한 코드입니다. 외부 사이트에서 우리가 만든 사이트에 로그인 유저 권한으로 공격하는 것을 막습니다. `{{ form.as_p }}`에서 `form`은 `BookmarkCreateView`가 넣어준 값인데 우리가 설정한 "fields"에 따라 input 필드 태그를 만들어줍니다. `as_p`는 이 태그들을 p 태그로 감싸줍니다. 

자, 마지막으로 목록 페이지에서 Add Bookmark 링크에 우리 "bookmark/add" url을 달아보겠습니다. `bookmark/templates/bookmark/bookmark_list.html`을 다음처럼 수정해주세요.

bookmark/bookmark/templates/bookmark/bookmark_create.html
```html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>북마크 리스트 뷰</title>
    </head>
    <body>
        <div class="btn-group">
            <a href="{% url 'add' %}" class="btn btn-info">Add Bookmark</a>
        </div>
        <!-- 이전 코드와 동일 -->
    </body>
</html>
```

템플릿 엔진의 도움으로 이렇게 하면 해당 앱의 설정한 url 이름으로 url을 동적으로 매핑시켜줍니다. 이제 개발 서버를 키고 잘 동작하나 확인해보세요.

## 북마크 상세 보기 기능 만들기


## 북마크 수정 기능 만들기


## 북마크 UI 개선하기


## 배포하기


## 마치며..

