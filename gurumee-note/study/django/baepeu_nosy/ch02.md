장고 시작하기
=====================

> 책 "베프의 오지랖 파이썬 웹 프로그래밍" 정리한 문서입니다. 책은 저자들의 소중한 자산이기 때문에 책에 나와 있는 모든 내용을 기술하지 않고 최대한 압축해서 정리할 예정입니다. 이 책을 정리하는 이유는 "11번가 하계 인턴" 동안 수행해야 하는 개인 과제 "통합 검색 서비스"를 만들기 위해서 연구 목적입니다.

Contents
-------------

이번 장에서 배울 목차는 다음과 같습니다.

1. 시작하며..
2. 기본 프로젝트 만들기
3. 프로젝트 구성 요소
4. 장고 기본 명령어들
5. 디자인 패턴과 MTV
6. 마치며..


## 시작하며..

이번 장에서는 파이썬 가상환경을 이용하여 장고 프로젝트를 구성하고, 서버 실행을 포함한 기본 장고 명령어 및, 장고 구성 요소와 디자인 패턴인 MTV 패턴에 대해서 알아보도록 하겠습니다. 기본적으로 `python3` 가 설치되어있고 파이썬 패키지 중 하나인 `virtualenv`가 설치되어 있다고 가정하겠습니다. 설치 되어 있는지 확인하려면 다음의 명령어로 확인할 수 있습니다.  

```bash
# 파이썬 버전 확인
$ python3 -V
Python 3.7.3

# pip 버전 확인
$ pip3 -V
pip 18.1 from /usr/lib/python3/dist-packages/pip (python 3.7)

# virtualenv 버전 확인
$ virtualenv --version
16.6.0
```

버전은 여러분의 환경에 따라 상이할 수 있습니다. `virtualenv`는 다음 명령어로 설치할 수 있습니다.

```bash
$ pip3 install virtualenv
```


## 기본 프로젝트 만들기

자 이제 3장에 쓰일 프로젝트를 미리 생성해두겠습니다. 먼저 적당한 위치에 프로젝트 디렉토리를 `django-tutorial`의 이름으로 만들어주세요.

```bash
# 프로젝트 루트 디렉토리 생성
$ mkdir django-tutorial

# 프로젝트 이동
$ cd django-tutorial
```

그 후, 파이썬 가상 환경을 만들겠습니다. 

```bash
$ python3 -m virtualenv venv
```

가상 환경은 의존성을 관리하는데 좋습니다. 컴퓨터에 여러 파이썬 프로젝트가 존재할 경우, 각 프로젝트에서 의존하는 패키지 버전들이 꼬일 수 있는데 이를 이용하면 프로젝트마다 의존성을 관리할 수 있습니다. 이제 가상 환경을 실행시켜보도록 하겠씁니다.

```bash
$ source venv/bin/activate

$ (venv)
```

실행하면 우리가 지정한 (venv) 가 우리 터미널에 뜨는 것을 확인할 수 있습니다. 이것이 가상환경이 활성화가 잘 이루어진 것입니다. 자, 이제 장고 프레임워크 의존성을 설치하도록 합시다.

```bash
$ (venv) pip install django
```

그 후 프로젝트를 만들겠습니다.

```bash
$ (venv) django-admin startproject config .
```

이제 다음 명령어로 서버를 실행하면 서버가 켜질 것입니다.

```bash
$ (venv) python manage.py runserver
```

## 프로젝트 구성 요소

자 이제 프로젝트 구성 요소들을 살펴볼까요?

- config
    - __init__.py
    - settings.py
    - urls.py
    - wsgi.py
- venv
- manage.py

먼저 config 폴더는 프로젝트 설정 파일과 웹 서비스 실행을 위한 파일들이 들어있는 디렉토리입니다. `django-admin startproject config .` 명령어로 만들어진 디렉토리이며 이름은 꼭 'config' 라고 지을 필요는 없습니다.

__init.py__ 는 파이썬 2 버전과 호환을 위해 만들어진 파일입니다. 파이썬 3 버전이라면 지워도 딱히 상관은 없습니다.

settings.py 는 프로잭트 설정에 관한 다양한 내용이 들어있습니다.

urls.py 는 프로젝트 전체 url 정보들이 담겨 있습니다. 여기서 장고로 만들어진 프로젝트에서 앱이라는 구성 요소가 있는데, 이 앱이 갖는 url들을 연결하는 역할을 합니다.

wsgi.py는 웹 서비스를 실행하기 위한 wsgi 내용이 들어있습니다. 특별히 변경할 필요는 없습니다.

venv 폴더는 전에 말했던데로 의존성 라이브러리 및 구동에 필요한 환경이 들어있습니다. 삭제는 하지 않는 것이 좋습니다.

manage.py 는 서버를 구동시키는 `python manage.py runserver` 명령어 같은 장고 프로젝트의 다양한 명령어들을 실행하기 위한 파일입니다. 삭제/변경은 하면 안됩니다.

여기서 조금 더 중요한 settings.py 에 대해서 알아보도록 하겠습니다.

### settings.py

앞서 말했듯 프로젝트 관련 다양한 설정들이 들어있습니다. 간단하게 알아보도록 하겠습니다.

#### BASE_DIR

프로젝트 루트 폴더, 설정 파일이나 파이썬 파일 등에서 프로젝트 루트 폴더를 찾아 그 하위를 탐색하거나 하는 일들을 빈번하게 수행합니다. 이 때문에 변수로 미리 준비해두는 값입니다.

#### SECRET_KEY

다양한 보안을 위해 사용됩니다. 외부에 노출되서는 안됩니다.

#### DEBUG

디버그 모드 실행 여부를 True/False 값으로 설정합니다. 

#### ALLOWED_HOSTS

현재 서비스의 호스트를 설정합니다. 개발 시에는 비어두고 사용하고 배포할 땐 "*" 혹은 실제 도메인을 입력해둡니다.

#### INSTALLED_APPS

장고는 여러 앱의 결합으로 만들어집니다. 현재 프로젝트에서 관리하는 앱의 목록을 기록하고 관리합니다.

#### MIDDLEWARE

장고의 모든 요청/응답 메시지 사이에 실행되는 특수한 프레임워크들입니다. 주로 보안에 관한 내용들이 많습니다.

#### ROOT_URLCONF

기준이 되는 urls.py 파일의 경로를 설정합니다.

#### TEMPLATES

장고에서 사용하는 템플릿 시스템에 관한 설정들입니다. 보통 템플릿 폴ㄷ어의 경로를 변경하는데 쓰입니다.

#### WSGI_APPLICATION

실행을 위한 wsgi 애플리케이션을 설정합니다.

#### DATABASES

DB 관련 설정입니다.

#### AUTH_PASSWORD_VALIDATORS

비밀번호 검증을 위한 설정입니다. 기본적으로 사용자 정보와 유사한지, 숫자로만 만들어졌는지 등 검증하도록 되어 있습니다.

#### LANGUAGE_CODE

다국어에 관한 설정입니다.

    참고! 기록되지 않은 설정들
    물론 settings.py 에 들어있지 않은 기본 설정들이 있습니다. 그러한 값들을 확인하려면, `django/conf/global_settings.py` 를 살펴보십시오. 가상환경의 경우 해당 경로는 다음과 같을 것입니다. ~/project/venv/lib/python3.x/site-packages/django/conf/global_settings.py


## 장고 기본 명령어들

보통은 python manage.py (명령어) 형태로 명령어들을 실행시킬 수 있습니다. 다음은 명령어 목록들입니다.

1. django-admin startproject
    유일하게 manage.py를 거치지 않는 명령어입니다. 장고 프로젝트를 생성하는데 사용됩니다. 
2. startapp
    프로젝트에 기능 단위인 앱을 새로 만들 때 사용합니다.
3. makemigrations
    애플리케이션 변경 사항을 추적해 db에 적용할 내용을 정리합니다.
4. sqlmigrate
    실행할 SQL 명령문들을 출력합니다.
5. migrate
    실제 변경사항을 DB에 입력합니다.
6. showmigarations
    프로젝트 DB 변경사항 목록과 상태를 출력합니다.
7. runserver
    웹 서버를 실행합니다. 기본 포트는 8000입니다.
8. dumpdata
    현재 DB 내용을 백업할 때 사용합니다
9. loaddata
    백업 파일에서 DB 내용을 복구합니다.
10. flush
    DB 테이블만 남기고 모든 데이터를 삭제합니다.
11. shell
    장고 쉘을 실행합니다. 작성한 모델 등을 불러와 실제로 테스트할 수 있습니다.
12. dbshell
    DB에 접근할 수 있는 쉘을 실행합니다. 앱에서 DB 때문에 실행이 불가능할 때 켜서 수정하는 용도로 쓰입니다.
13. createsuperuser
    관리자 계정을 생성합니다.
14. changepassword 
    계정의 비밀번호를 변경합니다.


## 디자인 패턴과 MTV

"디자인 패턴이란 설계 문제의 해답이라고 할 수 있습니다." - 책 인용

책에서 말하는 디자인 패턴은 MVC 패턴을 말합니다. 모델 뷰 컨트롤러 계층을 나누어 개발하는 것이지요. 그렇게 함으로써 유지보수가 쉬워지고 개발 향상성을 올리는 것입니다. 장고에서는 보통 MTV 패턴이라고 부릅니다. 다음은 MVC와 MTV에 대응하는 것을 표로 나타낸 것입니다.

| MVC | MTV |
| :---: | :---: |
| Model | Model |
| View | Template |
| Controller | View |

* 모델 
    * 데이터베이스 구조를 결정합니다. 대부분의 경우 테이블을 작성할 때 사용하는데, 테이블의 이름 각 열의 이름과 타입등을 설계할 때 사용합니다. 장고에서는 models.py 에서 관리합니다.
* 뷰 (템플릿) : 사용자에게 보여지는 UI 부분입니다. HTML 코드등 클라이언트에게 실질적으로 보여지는 계층입니다. 장고에서는 templates 디렉토리의 파일들을 뜻합니다.
* 컨트롤러(뷰) : 기능, 비지니스로직을 담고 있는 계층입니다. 데이터를 어떻게 해석하고 처리된 결과를 어떻게 보여줄지 결정합니다. 장고에서는 views.py, urls.py들을 뜻합니다. urls.py는 컨트롤러(뷰)가 어떤 url에 매핑되는지 정의하고 비지니스로직은 views.py 에서 기술합니다.


## 마치며..

이번 장에서는 장고를 설치해서 프로젝트를 구성해보고 각 구성 요소가 어떤 것이 있는지 알아보았습니다. 다음 장에서는 장고 튜토리얼을 따라해보며, 장고에 대략적인 감을 잡아보도록 합시다!
