스프링 부트 원리 1부 의존성 관리와 자동 설정
============================

> 인프런 강좌 "백기선의 스프링 부트"와 책 "스프링 철저 입문"을 보고 스프링 부트에 대해 정리한 내용입니다. 

Contents
---------------

1. 시작하며..
2. 의존성 관리 이해
3. 의존성 관리 응용
4. 자동 설정 이해
5. 자동 설정 만들기 (1)
6. 자동 설정 만들기 (2)
7. 마치며..


## 시작하며..

이번 장에서는 의존성 관리, 자동 설정에 대해서 공부해보도록 하겠습니다.


## 의존성 관리 이해

스프링 부트의 가장 큰 장점이자, 이 프로젝트의 목표는 어려웠던 의존성 관리를 최소화시켜주는 것입니다. 어떻게 이런일이 가능할까요? 빌드 도구 메이븐을 이용할 시 답은 `pom.xml`에 있습니다. (아마 `gradle`도 비슷할 겁니다.) 다음 부분을 살펴보시죠.

pom.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
    <!-- 아래 부분을 살표보세요! -->
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.1.7.RELEASE</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<!-- ... -->
</project>
```
`parent`로 `spring-boot-starter-parent`를 지정하고 있는 것을 볼 수 있습니다. 한 번 자세히 볼까요? artifactId 부분을 `ctrl+좌 클릭`해서 넘어가봅시다. 여기서는 대부분 플러그인 설정과 빌드 설정에 대한 정보가 들어있습니다. 그럼 그 많은 의존성은 어디서 참조해오는 것일까요? 이번엔 `spring-boot-starter-parent`의 `parent`부분을 살펴봅시다.

spring-boot-starter-parent.pom
```xml
<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-dependencies</artifactId>
    <version>2.1.7.RELEASE</version>
    <relativePath>../../spring-boot-dependencies</relativePath>
  </parent>

  <!-- ... -->
</project>
```

또 `spring-boot-dependencies`를 부모를 삼고 있는 것을 볼 수 있습니다. 이 의존성 pom 파일에서 스프링 부트가 필요한 의존성을 모두 가져오는 것이지요. 쉽게 말해, `spring-boot-dependencies`는 의존성을, `spring-boot-starter-parent`는 빌드 및 플러그인 설정을 대신 해주고 있다고 생각하면 됩니다.

한 가지만 더 알아볼까요? 기존 프로젝트를 진행하고 있는 도중 스프링 부트 의존성을 추가하려면 어떻게 해야 할까요? 이 때는 2가지 방법이 존재합니다. 다음과 같습니다.

* 해당 프로젝트의 부모의 pom에 parent로 `spring-boot-starter-parent`를 지정합니다.
* dependenciesManagement 엘리먼트에 `spring-boot-dependencies`를 추가합니다.

여러모로 첫 번째 방식이 권장됩니다. 두 번째 방식은 의존성 관리는 들어오나, 빌드 및 플러그인 설정이 들어오지 않습니다. 이 작업을 개발자가 해야 하지요. 반면 첫번째의 경우 의존성을 타고 타고 들어오기 때문에, 스프링 부트를 사용하는 효과가 나옵니다.


## 의존성 관리 응용

이번에는 스프링 부트에서 정의된 프로퍼티를 오버라이딩하는 방법, 스프링 부트가 관리하는 의존성을 추가하는 방법, 관리하지 않는 의존성을 추가하는 방법에 대해 알아보겠습니다. 먼저 `pom.xml`을 다음과 같이 수정해주세요.

pom.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<!-- same code -->

	<properties>
		<java.version>11</java.version>
		<!-- 기존 프로퍼티 오버라이딩 -->
		<spring.version>5.0.6.RELEASE</spring.version>
	</properties>

	<dependencies>
		<!-- same code -->

		<!-- 의존성 추가 버전 관리 O -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>

		<!-- 의존성 추가 버전 관리 X -->
		<dependency>
			<groupId>org.modelmapper</groupId>
			<artifactId>modelmapper</artifactId>
			<version>2.1.0</version>
		</dependency>

		<!-- same code -->
	</dependencies>

	<!-- same code -->
</project>
```

먼저 `properties` 엘리먼트 밑에 `spring.version`에 대해서 오버라이딩하였습니다. 실제 `spring-boot-dependencies`에서 정의된 버전은 현재 5.1.9.RELEASE 입니다. 이것을 재 정의해주는 것이죠.

그리고 만약 스프링 부트가 관리하는 의존성이라면, `spring-boot-starter-data-jpa`처럼 `version`을 명시하지 않아도 됩니다. 하지만 관리하지 않는 의존성이라면, `modelmapper`처럼 groupId, artifactId와 더불어 version도 명시해 주어야 합니다.


## 자동 설정 이해

@SpringBootApplication = @SpringBootConfiguration + @EnableAutoConfiguration + @ComponentScan

빈으로 등록하는 2개의 설정

1. @ComponentScan 
2. @EnableAutoConfiguration

컴포넌트 스캔
@Configuration @Repository @Service @Controller @RestController 등 애노테이션이 붙은 모든 빈 스캐닝

spring-boot-autoconfigure, META-INF/spring.factories

## 자동 설정 만들기 (1)


## 자동 설정 만들기 (2)


## 마치며..

